# üìö API √în T·∫≠p T·ª´ V·ª±ng (Flashcard Review API)

## üéØ T·ªïng quan

API √¥n t·∫≠p t·ª´ v·ª±ng s·ª≠ d·ª•ng **thu·∫≠t to√°n SM-2 (SuperMemo 2)** ƒë·ªÉ t·ªëi ∆∞u h√≥a qu√° tr√¨nh ghi nh·ªõ t·ª´ v·ª±ng d√†i h·∫°n th√¥ng qua ph∆∞∆°ng ph√°p **Spaced Repetition** (L·∫∑p l·∫°i ng·∫Øt qu√£ng).

### ‚ú® T√≠nh nƒÉng ch√≠nh

-   L·∫•y danh s√°ch flashcard c·∫ßn √¥n t·∫≠p h√¥m nay
-   G·ª≠i ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng √¥n t·∫≠p (quality rating 0-5)
-   T·ª± ƒë·ªông t√≠nh to√°n l·ªãch √¥n t·∫≠p ti·∫øp theo d·ª±a tr√™n thu·∫≠t to√°n SM-2
-   Theo d√µi ti·∫øn ƒë·ªô h·ªçc t·∫≠p (timesCorrect, timesWrong, status)
-   Th·ªëng k√™ √¥n t·∫≠p h√¥m nay

---

## üßÆ Thu·∫≠t to√°n SM-2

### Quality Rating (0-5)

| ƒêi·ªÉm  | M√¥ t·∫£             | √ù nghƒ©a                             |
| ----- | ----------------- | ----------------------------------- |
| **5** | Perfect           | Nh·ªõ ho√†n h·∫£o, d·ªÖ d√†ng               |
| **4** | Correct           | ƒê√∫ng nh∆∞ng h∆°i do d·ª±                |
| **3** | Correct           | ƒê√∫ng nh∆∞ng kh√≥ nh·ªõ                  |
| **2** | Incorrect         | Sai nh∆∞ng g·∫ßn ƒë√∫ng                  |
| **1** | Incorrect         | Sai nh∆∞ng quen thu·ªôc khi xem ƒë√°p √°n |
| **0** | Complete blackout | Ho√†n to√†n kh√¥ng nh·ªõ                 |

### C√¥ng th·ª©c t√≠nh to√°n

```
1. Easiness Factor (EF):
   - Gi√° tr·ªã kh·ªüi t·∫°o: 2.5
   - EF m·ªõi = EF c≈© + (0.1 - (5 - quality) √ó (0.08 + (5 - quality) √ó 0.02))
   - EF t·ªëi thi·ªÉu: 1.3

2. Interval (Kho·∫£ng th·ªùi gian √¥n t·∫≠p):
   - N·∫øu quality < 3: B·∫Øt ƒë·∫ßu l·∫°i (interval = 1 ng√†y)
   - L·∫ßn 1: 1 ng√†y
   - L·∫ßn 2: 6 ng√†y
   - L·∫ßn 3+: interval = interval_tr∆∞·ªõc √ó EF

3. Status (Tr·∫°ng th√°i):
   - NEW: T·ª´ m·ªõi ch∆∞a √¥n t·∫≠p
   - LEARNING: ƒêang h·ªçc (interval ‚â§ 21 ng√†y)
   - MASTERED: ƒê√£ thu·ªôc (interval > 21 ng√†y)
```

### V√≠ d·ª• th·ª±c t·∫ø

```
Ng√†y 1: H·ªçc t·ª´ "apple"
  ‚Üí Quality: 4
  ‚Üí Interval: 1 ng√†y
  ‚Üí Next review: Ng√†y 2

Ng√†y 2: √în "apple"
  ‚Üí Quality: 5
  ‚Üí Interval: 6 ng√†y
  ‚Üí Next review: Ng√†y 8

Ng√†y 8: √în "apple"
  ‚Üí Quality: 4
  ‚Üí EF: 2.5 ‚Üí 2.4
  ‚Üí Interval: 6 √ó 2.4 = 14 ng√†y
  ‚Üí Next review: Ng√†y 22

Ng√†y 22: √în "apple"
  ‚Üí Quality: 5
  ‚Üí EF: 2.4 ‚Üí 2.5
  ‚Üí Interval: 14 √ó 2.5 = 35 ng√†y
  ‚Üí Status: MASTERED (interval > 21)
  ‚Üí Next review: Ng√†y 57
```

---

## üì° API Endpoints

### 1. L·∫•y danh s√°ch flashcard c·∫ßn √¥n t·∫≠p

**GET** `/api/v1/flashcard-review/due`

L·∫•y t·∫•t c·∫£ flashcard ƒë·∫øn h·∫°n √¥n t·∫≠p h√¥m nay.

#### Headers

```
Authorization: Bearer {token}
```

#### Query Parameters

| Tham s·ªë | Type    | B·∫Øt bu·ªôc | M√¥ t·∫£                                        |
| ------- | ------- | -------- | -------------------------------------------- |
| limit   | Integer | Kh√¥ng    | S·ªë l∆∞·ª£ng flashcard t·ªëi ƒëa (m·∫∑c ƒë·ªãnh: t·∫•t c·∫£) |

#### Response

```json
{
    "success": true,
    "message": "L·∫•y danh s√°ch flashcard c·∫ßn √¥n t·∫≠p th√†nh c√¥ng",
    "data": {
        "totalDueCards": 15,
        "reviewedToday": 0,
        "remainingCards": 15,
        "flashcards": [
            {
                "vocabId": "uuid",
                "word": "apple",
                "transcription": "/Àà√¶p.…ôl/",
                "meaningVi": "qu·∫£ t√°o",
                "interpret": "A round fruit with red or green skin",
                "exampleSentence": "I eat an apple every day.",
                "img": "https://example.com/apple.jpg",
                "audio": "https://example.com/apple.mp3",
                "lastReviewed": "2025-10-15",
                "nextReviewDate": "2025-10-16",
                "timesCorrect": 3,
                "timesWrong": 1,
                "repetition": 3,
                "efFactor": 2.4,
                "intervalDays": 14,
                "status": "LEARNING"
            }
        ]
    }
}
```

---

### 2. L·∫•y th√¥ng tin m·ªôt flashcard

**GET** `/api/v1/flashcard-review/flashcard/{vocabId}`

L·∫•y chi ti·∫øt flashcard c·ªßa m·ªôt t·ª´ v·ª±ng c·ª• th·ªÉ.

#### Headers

```
Authorization: Bearer {token}
```

#### Path Parameters

| Tham s·ªë | Type | M√¥ t·∫£          |
| ------- | ---- | -------------- |
| vocabId | UUID | ID c·ªßa t·ª´ v·ª±ng |

#### Response

```json
{
    "success": true,
    "message": "L·∫•y th√¥ng tin flashcard th√†nh c√¥ng",
    "data": {
        "vocabId": "uuid",
        "word": "book",
        "transcription": "/b äk/",
        "meaningVi": "s√°ch",
        "interpret": "A set of printed pages bound together",
        "exampleSentence": "She is reading a book.",
        "img": "https://example.com/book.jpg",
        "audio": "https://example.com/book.mp3",
        "lastReviewed": null,
        "nextReviewDate": "2025-10-16",
        "timesCorrect": 0,
        "timesWrong": 0,
        "repetition": 0,
        "efFactor": 2.5,
        "intervalDays": 1,
        "status": "NEW"
    }
}
```

---

### 3. G·ª≠i k·∫øt qu·∫£ √¥n t·∫≠p ‚≠ê

**POST** `/api/v1/flashcard-review/submit`

G·ª≠i ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng √¥n t·∫≠p v√† c·∫≠p nh·∫≠t ti·∫øn ƒë·ªô.

#### Headers

```
Authorization: Bearer {token}
Content-Type: application/json
```

#### Request Body

```json
{
    "vocabId": "uuid",
    "quality": 4,
    "timeSpentSeconds": 15
}
```

| Tr∆∞·ªùng           | Type    | B·∫Øt bu·ªôc | M√¥ t·∫£                     |
| ---------------- | ------- | -------- | ------------------------- |
| vocabId          | UUID    | C√≥       | ID c·ªßa t·ª´ v·ª±ng            |
| quality          | Integer | C√≥       | ƒê√°nh gi√° ch·∫•t l∆∞·ª£ng (0-5) |
| timeSpentSeconds | Integer | Kh√¥ng    | Th·ªùi gian √¥n t·∫≠p (gi√¢y)   |

#### Response

```json
{
    "success": true,
    "message": "G·ª≠i k·∫øt qu·∫£ √¥n t·∫≠p th√†nh c√¥ng",
    "data": {
        "vocabId": "uuid",
        "word": "apple",
        "quality": 4,
        "timesCorrect": 4,
        "timesWrong": 1,
        "repetition": 4,
        "efFactor": 2.4,
        "intervalDays": 33,
        "nextReviewDate": "2025-11-18",
        "status": "MASTERED",
        "remainingDueCards": 14,
        "totalReviewedToday": 0,
        "message": "Great job! üëç Review scheduled in 33 day(s)."
    }
}
```

#### Th√¥ng ƒëi·ªáp khuy·∫øn kh√≠ch

| Quality | Message                                           |
| ------- | ------------------------------------------------- |
| 5       | "Perfect! üåü You'll see this again in X day(s)."  |
| 4       | "Great job! üëç Review scheduled in X day(s)."     |
| 3       | "Good! Keep practicing. Next review in X day(s)." |
| 2       | "Almost there! üí™ You'll review this soon."       |
| 1       | "Don't worry, practice makes perfect! üìö"         |
| 0       | "Let's review this again tomorrow! üéØ"            |

---

### 4. Th·ªëng k√™ √¥n t·∫≠p h√¥m nay

**GET** `/api/v1/flashcard-review/stats`

L·∫•y th·ªëng k√™ s·ªë l∆∞·ª£ng flashcard ƒë√£ √¥n t·∫≠p v√† c√≤n l·∫°i.

#### Headers

```
Authorization: Bearer {token}
```

#### Response

```json
{
    "success": true,
    "message": "L·∫•y th·ªëng k√™ √¥n t·∫≠p th√†nh c√¥ng",
    "data": {
        "totalDueCards": 15,
        "reviewedToday": 0,
        "remainingCards": 15,
        "flashcards": []
    }
}
```

---

## üîÑ Workflow √¥n t·∫≠p ƒëi·ªÉn h√¨nh

```
1. User m·ªü app
   ‚Üì
2. GET /flashcard-review/due?limit=10
   ‚Üí L·∫•y 10 flashcard c·∫ßn √¥n t·∫≠p
   ‚Üì
3. Hi·ªÉn th·ªã t·ª´ v·ª±ng ƒë·∫ßu ti√™n
   ‚Üí User ƒë·ªçc t·ª´ ‚Üí Nghƒ© nghƒ©a ‚Üí L·∫≠t flashcard
   ‚Üì
4. User ƒë√°nh gi√° quality (0-5)
   ‚Üì
5. POST /flashcard-review/submit
   {
     "vocabId": "uuid",
     "quality": 4
   }
   ‚Üí C·∫≠p nh·∫≠t progress, t√≠nh next review date
   ‚Üì
6. Nh·∫≠n response v·ªõi remainingDueCards
   ‚Üì
7. N·∫øu c√≤n flashcard ‚Üí Quay l·∫°i b∆∞·ªõc 3
   N·∫øu h·∫øt ‚Üí Hi·ªÉn th·ªã th√¥ng b√°o ho√†n th√†nh
```

---

## üìä Database Schema

### Table: `user_vocab_progress`

| Column           | Type        | Description                 |
| ---------------- | ----------- | --------------------------- |
| id               | UUID        | Primary key                 |
| user_id          | UUID        | FK to users                 |
| vocab_id         | UUID        | FK to vocab                 |
| status           | VARCHAR(50) | NEW, LEARNING, MASTERED     |
| last_reviewed    | DATE        | Ng√†y √¥n t·∫≠p g·∫ßn nh·∫•t        |
| times_correct    | INTEGER     | S·ªë l·∫ßn tr·∫£ l·ªùi ƒë√∫ng         |
| times_wrong      | INTEGER     | S·ªë l·∫ßn tr·∫£ l·ªùi sai          |
| ef_factor        | DOUBLE      | Easiness Factor (SM-2)      |
| interval_days    | INTEGER     | Kho·∫£ng th·ªùi gian √¥n t·∫≠p     |
| repetition       | INTEGER     | S·ªë l·∫ßn ƒë√£ √¥n t·∫≠p th√†nh c√¥ng |
| next_review_date | DATE        | Ng√†y √¥n t·∫≠p ti·∫øp theo       |

---

## üé® Frontend Integration Tips

### 1. Flashcard Component

```jsx
const FlashcardReview = () => {
    const [flashcard, setFlashcard] = useState(null);
    const [showAnswer, setShowAnswer] = useState(false);

    const handleFlip = () => setShowAnswer(!showAnswer);

    const handleReview = async (quality) => {
        await axios.post('/api/v1/flashcard-review/submit', {
            vocabId: flashcard.vocabId,
            quality,
        });
        loadNextFlashcard();
    };

    return (
        <div className="flashcard">
            {!showAnswer ? (
                <div onClick={handleFlip}>
                    <h1>{flashcard.word}</h1>
                    <p>{flashcard.transcription}</p>
                </div>
            ) : (
                <div>
                    <h1>{flashcard.word}</h1>
                    <p>{flashcard.meaningVi}</p>
                    <p>{flashcard.exampleSentence}</p>

                    <div className="quality-buttons">
                        <button onClick={() => handleReview(0)}>‚ùå Kh√¥ng nh·ªõ</button>
                        <button onClick={() => handleReview(1)}>üòï Quen quen</button>
                        <button onClick={() => handleReview(2)}>ü§î G·∫ßn ƒë√∫ng</button>
                        <button onClick={() => handleReview(3)}>üòä ƒê√∫ng nh∆∞ng kh√≥</button>
                        <button onClick={() => handleReview(4)}>üòÉ ƒê√∫ng</button>
                        <button onClick={() => handleReview(5)}>üåü Ho√†n h·∫£o</button>
                    </div>
                </div>
            )}
        </div>
    );
};
```

### 2. Progress Tracking

```jsx
const ReviewProgress = () => {
    const [stats, setStats] = useState(null);

    useEffect(() => {
        const fetchStats = async () => {
            const response = await axios.get('/api/v1/flashcard-review/stats');
            setStats(response.data.data);
        };
        fetchStats();
    }, []);

    return (
        <div className="review-progress">
            <h3>üìä Ti·∫øn ƒë·ªô h√¥m nay</h3>
            <p>T·ªïng c·∫ßn √¥n: {stats?.totalDueCards}</p>
            <p>ƒê√£ √¥n: {stats?.reviewedToday}</p>
            <p>C√≤n l·∫°i: {stats?.remainingCards}</p>
            <ProgressBar value={stats?.reviewedToday} max={stats?.totalDueCards} />
        </div>
    );
};
```

---

## üß™ Testing v·ªõi Postman/cURL

### Get Due Flashcards

```bash
curl -X GET "http://localhost:8080/api/v1/flashcard-review/due?limit=5" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### Submit Review

```bash
curl -X POST "http://localhost:8080/api/v1/flashcard-review/submit" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "vocabId": "123e4567-e89b-12d3-a456-426614174000",
    "quality": 4
  }'
```

---

## üìà Best Practices

### 1. Daily Review

-   Khuy·∫øn kh√≠ch user √¥n t·∫≠p **m·ªói ng√†y**
-   Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng flashcard c·∫ßn √¥n t·∫≠p tr√™n notification

### 2. Quality Rating Guidelines

-   Cung c·∫•p **h∆∞·ªõng d·∫´n r√µ r√†ng** cho m·ªói m·ª©c quality
-   Kh√¥ng c·∫ßn "perfect" m·ªõi ƒë√∫ng ‚Üí Quality 3 c≈©ng tƒÉng interval

### 3. Gamification

-   Th√™m **streak** (chu·ªói ng√†y √¥n t·∫≠p li√™n ti·∫øp)
-   Th√™m **daily goal** (m·ª•c ti√™u s·ªë flashcard/ng√†y)
-   Badge cho milestones (100, 500, 1000 t·ª´ mastered)

### 4. Analytics

-   Track **average quality** ƒë·ªÉ ƒë√°nh gi√° ƒë·ªô kh√≥
-   Track **time spent** ƒë·ªÉ c·∫£i thi·ªán UX
-   Hi·ªÉn th·ªã **learning curve** (progress over time)

---

## üîß Troubleshooting

### Issue: Kh√¥ng c√≥ flashcard c·∫ßn √¥n t·∫≠p

**Gi·∫£i ph√°p:**

-   Ki·ªÉm tra `next_review_date` trong database
-   ƒê·∫£m b·∫£o user ƒë√£ h·ªçc t·ª´ v·ª±ng (status != NULL)
-   Test v·ªõi `GET /flashcard-review/flashcard/{vocabId}` ƒë·ªÉ t·∫°o progress m·ªõi

### Issue: Interval tƒÉng qu√° nhanh

**Gi·∫£i ph√°p:**

-   ƒêi·ªÅu ch·ªânh EF calculation
-   Gi·∫£m multiplier cho repetition >= 3
-   Set max interval (v√≠ d·ª•: 180 ng√†y)

### Issue: User qu√™n t·ª´ nh∆∞ng v·∫´n status MASTERED

**Gi·∫£i ph√°p:**

-   Khi quality < 3 ‚Üí Reset status v·ªÅ LEARNING
-   ƒêi·ªÅu ch·ªânh threshold (hi·ªán t·∫°i: interval > 21 ‚Üí MASTERED)

---

## üìö T√†i li·ªáu tham kh·∫£o

-   [SuperMemo SM-2 Algorithm](https://www.supermemo.com/en/archives1990-2015/english/ol/sm2)
-   [Spaced Repetition on Wikipedia](https://en.wikipedia.org/wiki/Spaced_repetition)
-   [Anki Algorithm](https://faqs.ankiweb.net/what-spaced-repetition-algorithm.html)

---

## üéâ T·ªïng k·∫øt

API √¥n t·∫≠p n√†y cung c·∫•p m·ªôt gi·∫£i ph√°p **khoa h·ªçc** v√† **hi·ªáu qu·∫£** ƒë·ªÉ gi√∫p ng∆∞·ªùi h·ªçc ghi nh·ªõ t·ª´ v·ª±ng l√¢u d√†i. Thu·∫≠t to√°n SM-2 ƒë√£ ƒë∆∞·ª£c ch·ª©ng minh qua h√†ng tri·ªáu ng∆∞·ªùi d√πng tr√™n th·∫ø gi·ªõi (Anki, Duolingo, Memrise).
