# Notification Module Test-Care

| ID    | Scenario                    | Preconditions                                                | Steps                                                                                                 | Expected Result                                                                        | Test Type           |
| ----- | --------------------------- | ------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- | ------------------- |
| NT-01 | Tạo notification thành công | User hợp lệ tồn tại, request type nằm trong danh sách hợp lệ | Gọi `NotificationService.createNotification` với request hợp lệ                                       | Notification được lưu, WebSocket push tới `/queue/notifications`                       | Unit                |
| NT-02 | Đánh dấu đã đọc thành công  | Notification thuộc user đang đăng nhập                       | Gọi `NotificationService.markAsRead` với `notificationId` hợp lệ                                      | Repository trả số bản ghi cập nhật > 0, WebSocket push tới `/queue/notifications/read` | Unit                |
| NT-03 | Đánh dấu đã đọc thất bại    | Notification không tồn tại hoặc không thuộc user             | Gọi `NotificationService.markAsRead` với repository trả về 0                                          | Service ném `ErrorException`, không có WebSocket push                                  | Unit                |
| NT-04 | Xóa notification sai quyền  | Notification thuộc user khác                                 | Mock `notificationRepository.findById` trả về notification với user khác rồi gọi `deleteNotification` | Service ném `ErrorException`, không xóa                                                | Unit                |
| NT-05 | Nhắc nhở streak tự động     | User học hôm qua, chưa học hôm nay, streak >= 3              | Chạy `StreakReminderScheduler.sendStreakReminders` với dữ liệu mock                                   | Notification + email được gửi, đếm số reminder tăng                                    | Integration/Service |
| NT-06 | Cảnh báo gãy chuỗi          | User học ngày -2 nhưng bỏ lỡ ngày hôm qua                    | Chạy `sendStreakStopAlerts`                                                                           | Notification `streak_break` được tạo                                                   | Integration/Service |

> Các test NT-05/NT-06 sẽ được bổ sung sau dưới dạng integration test hoặc sử dụng testcontainers. File này tạm thời tập trung vào unit test cho `NotificationService`.
