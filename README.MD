# ğŸ´ Card Words Services

> Monorepo chá»©a táº¥t cáº£ services cá»§a Card Words Platform: Backend API (Spring Boot) vÃ  AI Service (Python FastAPI)

[![Java](https://img.shields.io/badge/Java-17-orange)](https://www.oracle.com/java/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.5-brightgreen)](https://spring.io/projects/spring-boot)
[![Python](https://img.shields.io/badge/Python-3.11-blue)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-Latest-009688)](https://fastapi.tiangolo.com/)
[![Docker](https://img.shields.io/badge/Docker-Compose-2496ED)](https://www.docker.com/)

---

## ğŸ“ Cáº¥u trÃºc Monorepo

```
card-words-services/
â”œâ”€â”€ card-words/              # Spring Boot Backend API
â”‚   â”œâ”€â”€ src/                 # Java source code
â”‚   â”œâ”€â”€ pom.xml             # Maven dependencies
â”‚   â””â”€â”€ Dockerfile          # Docker build cho Spring Boot
â”‚
â”œâ”€â”€ card-words-ai/          # Python AI Service
â”‚   â”œâ”€â”€ app/                # FastAPI application
â”‚   â”œâ”€â”€ models/             # LightGBM models
â”‚   â”œâ”€â”€ pyproject.toml      # Poetry dependencies
â”‚   â””â”€â”€ Dockerfile          # Docker build cho Python
â”‚
â”œâ”€â”€ docs/                   # Documentation
â”‚   â”œâ”€â”€ auth/              # Authentication guides
â”‚   â”œâ”€â”€ docker/            # Docker setup guides
â”‚   â”œâ”€â”€ AI/                # AI/ML documentation
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docker-compose.yml     # âœ¨ SHARED Docker Compose (Táº¤T Cáº¢ SERVICES)
â”œâ”€â”€ .env                   # âœ¨ SHARED Environment Variables
â”œâ”€â”€ .gitignore            # Monorepo gitignore
â””â”€â”€ README.md             # This file
```

---

## ğŸš€ Quick Start

### Prerequisites

-   **Docker Desktop** (hoáº·c Docker Engine + Docker Compose)
-   **Java 17+** (náº¿u cháº¡y local)
-   **Maven 3.9+** (náº¿u build local)
-   **Python 3.11+** (náº¿u cháº¡y AI service local)

### ğŸ³ Cháº¡y táº¥t cáº£ services vá»›i Docker (Recommended)

```bash
# 1. Di chuyá»ƒn vÃ o thÆ° má»¥c root
cd card-words-services

# 2. Táº¡o file .env tá»« template
cp .env.example .env
# Sau Ä‘Ã³ chá»‰nh sá»­a .env vá»›i thÃ´ng tin cá»§a báº¡n

# 3. Start táº¥t cáº£ services
docker-compose up -d

# 4. Xem logs
docker-compose logs -f

# 5. Kiá»ƒm tra status
docker-compose ps
```

**Services sáº½ cháº¡y trÃªn:**

-   ğŸŒ **Spring Boot API**: http://localhost:8080
    -   Swagger UI: http://localhost:8080/swagger-ui.html
    -   API Docs: http://localhost:8080/v3/api-docs
-   ğŸ¤– **AI Service**: http://localhost:8001
    -   API Docs: http://localhost:8001/docs
-   ğŸ—„ï¸ **PostgreSQL**: localhost:5433
    -   Database: `card_words`
    -   User: `postgres`
-   ğŸ”´ **Redis**: localhost:6379
    -   DB 0: Spring Boot cache
    -   DB 1: AI Service cache
-   ğŸ”§ **PgAdmin**: http://localhost:5050
    -   Email: admin@cardwords.com
    -   Password: admin
-   ğŸ“Š **Redis Insight**: http://localhost:5540

### ğŸ¯ Test APIs

**1. Health Check:**

```bash
curl http://localhost:8080/actuator/health
curl http://localhost:8001/health
```

**2. Test Email System:**

```bash
# Register a new user (triggers welcome email)
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "password": "password123"
  }'

# Check your email inbox for welcome email
```

**3. Test Streak Reminder (Manual Trigger):**

Táº¡m thá»i thay Ä‘á»•i cron schedule trong `StreakReminderScheduler.java`:

```java
// Cháº¡y ngay sau 10 giÃ¢y (Ä‘á»ƒ test)
@Scheduled(fixedDelay = 10000, initialDelay = 5000)
```

Rebuild vÃ  check logs:

```bash
docker-compose build card-words-api
docker-compose up -d
docker-compose logs -f card-words-api | grep "streak"
```

**4. Register User:**

```bash
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "password": "password123"
  }'
```

**3. Access Swagger UI:**

-   Open http://localhost:8080/swagger-ui.html
-   Click "Authorize" button
-   Enter token: `Bearer <your-jwt-token>`
-   Try out APIs

---

## ğŸ“¦ Services

### 1ï¸âƒ£ card-words (Spring Boot Backend)

**CÃ´ng nghá»‡:**

-   Spring Boot 3.2.5
-   Java 17
-   PostgreSQL 16
-   Redis 7
-   Spring Security + JWT
-   Google OAuth2
-   Firebase Storage
-   Flyway Migration

**Ports:**

-   Application: `8080`
-   Database: `5433` (external)

**Core Features:**

-   ğŸ” Authentication (JWT + Google OAuth2)
-   ğŸ“š Vocabulary Management (CRUD, Search, Filters)
-   ğŸ® Games (Quick Quiz, Image-Word Matching, Word Definition Matching)
-   ğŸ“Š Leaderboard & Statistics
-   ğŸ”¥ Streak System (Daily learning tracking + automated email reminders)
-   ğŸ”” **Notifications System** (Auto-triggered achievements, streak milestones, admin broadcasts)
-   ğŸ“ **Action Logs** (Admin monitoring of user activities)
-   ğŸ“§ **Email Service** (Welcome, activation, password reset, streak reminders)
-   â° **Scheduled Jobs** (Daily streak reminders at 9:00 AM)
-   ğŸ’¾ Offline Sync Support
-   ğŸŒ Multi-language Support

**Documentation:**

-   API Docs: http://localhost:8080/swagger-ui.html
-   Actuator: http://localhost:8080/actuator
-   Admin Dashboard APIs: [docs/admin/ADMIN_DASHBOARD_API.md](docs/admin/ADMIN_DASHBOARD_API.md)
-   Notifications: [docs/admin/NOTIFICATIONS_API.md](docs/admin/NOTIFICATIONS_API.md)
-   Action Logs: [docs/admin/ACTION_LOGS_API.md](docs/admin/ACTION_LOGS_API.md)

### 2ï¸âƒ£ card-words-ai (Python AI Service)

**CÃ´ng nghá»‡:**

-   Python 3.11
-   FastAPI
-   LightGBM (Machine Learning)
-   PostgreSQL (read-only)
-   Redis (caching)

**Ports:**

-   API: `8001`

**Features:**

-   Smart Vocabulary Review (LightGBM predictions)
-   Redis caching cho performance
-   JWT authentication vá»›i Spring Boot

---

## âš™ï¸ Configuration

### Environment Variables (`.env`)

```env
# Server Ports
SERVER_SPRING_PORT=8080
SERVER_FLASH_PORT=8001

# Database
POSTGRES_DB=card_words
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_password
POSTGRES_EXTERNAL_PORT=5433

# Redis
REDIS_EXTERNAL_PORT=6379
REDIS_AI_DB=1

# JWT
JWT_SECRET=your_jwt_secret

# Email (For welcome, activation, password reset, streak reminders)
MAIL_USERNAME=your_email@gmail.com
MAIL_PASSWORD=your_app_password  # Gmail App Password

# Google OAuth2
GOOGLE_OAUTH_CLIENT_ID=your_client_id
GOOGLE_OAUTH_CLIENT_SECRET=your_client_secret

# Firebase
FIREBASE_STORAGE_BUCKET=your_bucket
```

**âš ï¸ LÆ¯U Ã:** File `.env` chá»©a thÃ´ng tin nháº¡y cáº£m, khÃ´ng commit lÃªn Git!

---

## ğŸ”§ Development

### Cháº¡y tá»«ng service riÃªng láº»

#### Spring Boot (card-words)

```bash
cd card-words

# Build
mvn clean package -DskipTests

# Run
mvn spring-boot:run

# Hoáº·c
java -jar target/card-words-0.0.1-SNAPSHOT.jar
```

#### AI Service (card-words-ai)

```bash
cd card-words-ai

# Install dependencies
poetry install

# Run
poetry run uvicorn app.main:app --reload --port 8001
```

### Build Docker Images

```bash
# Build táº¥t cáº£
docker-compose build

# Build tá»«ng service
docker-compose build card-words-api
docker-compose build card-words-ai

# Build vá»›i no cache
docker-compose build --no-cache
```

---

## ğŸ—„ï¸ Database

### Migrations

Database schema Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi **Flyway**:

-   Location: `card-words/src/main/resources/db/migration/`
-   Auto-run khi start application
-   Naming: `V{version}__{description}.sql`

**Current Migrations:**

-   V1: Initial schema (users, roles, topics, vocabs)
-   V2: Game sessions and details
-   V3: User vocabulary progress (spaced repetition)
-   V4: Streak system
-   V5: Leaderboard tables
-   V6: Notifications table
-   V7: Action logs table + missing columns

### Backup & Restore

```bash
cd card-words

# Backup
./backup-database.bat   # Windows
./backup-database.sh    # Linux/Mac

# Restore
./restore-database.bat  # Windows
./restore-database.sh   # Linux/Mac
```

Backups Ä‘Æ°á»£c lÆ°u trong: `card-words/database-backups/`

### Database Schema Highlights

**Core Tables:**

-   `users` - User accounts (UUID primary key)
-   `roles` - User roles (ADMIN, USER)
-   `topics` - Vocabulary topics/categories
-   `vocabs` - Vocabulary words with definitions, examples, images

**Game Tables:**

-   `games` - Game definitions (Quick Quiz, Image Matching, etc.)
-   `game_sessions` - User game sessions with scores
-   `game_session_details` - Individual questions/answers

**Progress Tables:**

-   `user_vocab_progress` - Spaced repetition tracking
-   `streak_records` - Daily learning streaks
-   `leaderboards` - Global & game-specific rankings

**Admin Tables:**

-   `notifications` - User notifications (achievements, reminders)
-   `action_logs` - Admin audit logs of user actions

---

## ğŸ§ª Testing

### Spring Boot Tests

```bash
cd card-words
mvn test
```

### AI Service Tests

```bash
cd card-words-ai
poetry run pytest
```

---

## ğŸ“Š Monitoring & Logs

### Xem logs

```bash
# Táº¥t cáº£ services
docker-compose logs -f

# Service cá»¥ thá»ƒ
docker-compose logs -f card-words-api
docker-compose logs -f card-words-ai

# Chá»‰ xem 100 dÃ²ng cuá»‘i
docker-compose logs --tail=100 -f
```

### Health Checks

```bash
# Spring Boot
curl http://localhost:8080/actuator/health

# AI Service
curl http://localhost:8001/health

# Database
docker-compose exec postgres pg_isready -U postgres
```

---

## ğŸ› ï¸ Troubleshooting

### Containers khÃ´ng start

```bash
# Stop táº¥t cáº£
docker-compose down

# XÃ³a volumes (âš ï¸ Máº¤T Dá»® LIá»†U)
docker-compose down -v

# Rebuild vÃ  start láº¡i
docker-compose up -d --build
```

### Port conflicts

```bash
# Kiá»ƒm tra port Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng
netstat -ano | findstr :8080    # Windows
lsof -i :8080                   # Mac/Linux

# Thay Ä‘á»•i port trong .env
SERVER_SPRING_PORT=8081
```

### Database connection failed

```bash
# Kiá»ƒm tra PostgreSQL logs
docker-compose logs postgres

# Test connection
docker-compose exec postgres psql -U postgres -d card_words -c '\dt'
```

---

## ğŸ“š Documentation

Chi tiáº¿t documentation cho tá»«ng module:

### Core Features

-   **Authentication**: [docs/auth/](docs/auth/)
-   **Vocabulary Management**: [docs/vocab/](docs/vocab/)
-   **Flash Cards**: [docs/flash_card/](docs/flash_card/)
-   **Topics**: [docs/topic/](docs/topic/)

### Games

-   **Quick Quiz**: [docs/quick_quiz/](docs/quick_quiz/)
-   **Image-Word Matching**: [docs/image_word/](docs/image_word/)
-   **Word Definition Matching**: [docs/game/](docs/game/)
-   **Game Algorithms**: [docs/game/GAME_ALGORITHMS_DESIGN.md](docs/game/GAME_ALGORITHMS_DESIGN.md)

### Admin Features

-   **Admin Dashboard**: [docs/admin/ADMIN_DASHBOARD_API.md](docs/admin/ADMIN_DASHBOARD_API.md)
-   **Notifications API**: [docs/admin/NOTIFICATIONS_API.md](docs/admin/NOTIFICATIONS_API.md)
-   **Action Logs API**: [docs/admin/ACTION_LOGS_API.md](docs/admin/ACTION_LOGS_API.md)
-   **Notification Auto-Triggers**: [docs/admin/NOTIFICATION_AUTO_TRIGGERS.md](docs/admin/NOTIFICATION_AUTO_TRIGGERS.md)

### Advanced Features

-   **AI/ML Smart Review**: [docs/AI/](docs/AI/)
-   **Streak System**: [docs/streak/](docs/streak/)
-   **Leaderboard**: [docs/game/](docs/game/)
-   **Redis Caching**: [docs/redis/](docs/redis/)

### DevOps

-   **Docker Setup**: [docs/docker/](docs/docker/)
-   **Migration Guide**: [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md)
-   **Implementation Guide**: [docs/IMPLEMENTATION_GUIDE.md](docs/IMPLEMENTATION_GUIDE.md)

---

## ğŸ¤ Contributing

### Git Workflow

```bash
# Táº¡o branch má»›i
git checkout -b feature/your-feature-name

# Commit changes
git add .
git commit -m "feat: your feature description"

# Push
git push origin feature/your-feature-name

# Táº¡o Pull Request trÃªn GitHub
```

### Commit Message Convention

```
feat: thÃªm tÃ­nh nÄƒng má»›i (new feature)
fix: sá»­a bug (bug fix)
docs: cáº­p nháº­t documentation
refactor: refactor code (no functional changes)
test: thÃªm tests
chore: maintenance tasks (dependencies, configs)
perf: performance improvements
style: code formatting (no logic changes)
```

**Examples:**

```
feat: Add auto notification triggers for game achievements
fix: Fix UUID extraction in NotificationController
docs: Update README with new features
refactor: Simplify streak calculation logic
```

---

## ğŸ¯ Key Features Highlights

### ğŸ”” Notifications System

-   **Auto-triggered notifications** for game achievements (high scores, perfect accuracy)
-   **Streak milestone notifications** (7-day, 30-day, 100-day streaks)
-   **Automated streak reminders** (daily at 9 AM via email + in-app notification)
-   **Admin broadcast** to all users
-   Real-time unread count & filtering
-   5 notification types: `vocab_reminder`, `new_feature`, `achievement`, `system_alert`, `study_progress`

### ğŸ“§ Email System

-   **Welcome emails** with temporary password for new users
-   **Account activation** links
-   **Password reset** emails with secure tokens
-   **Streak reminders** (HTML template with beautiful design)
    -   Sent daily at 9:00 AM to users who:
        -   Studied yesterday âœ“
        -   Haven't studied today âœ—
        -   Have streak >= 3 days ğŸ”¥
    -   Dual channel: Email + In-app notification

### ğŸ“ Action Logs

-   **Admin monitoring** of all user actions
-   Track: login, logout, game completion, vocabulary learning
-   Advanced filtering by user, action type, status, date range
-   Export capabilities for audit reports
-   Statistics dashboard (total actions, success rate, unique users)

### ğŸ® Games

-   **Quick Quiz**: True/False lightning rounds with streak bonuses
-   **Image-Word Matching**: Memory-style image pairing game
-   **Word Definition Matching**: Match words to definitions
-   Smart scoring system with time bonuses
-   Leaderboard rankings (global & per-game)

### ğŸ”¥ Streak System

-   Track daily learning consistency
-   Auto-update on game completion
-   Milestone achievements (7, 30, 100 days)
-   Visual activity calendar
-   Personal record tracking

### ğŸ¤– AI Smart Review

-   **LightGBM ML model** for personalized review scheduling
-   Predicts optimal review timing based on:
    -   Correctness history
    -   Time since last review
    -   User performance patterns
-   Redis caching for fast predictions

---

## ğŸ‘¥ Team

-   **Backend Developer**: NgÃ´ Minh Thuáº­n
-   **AI/ML Engineer**: NgÃ´ Minh Thuáº­n

---

**Made with â¤ï¸ by Card Words Team**
